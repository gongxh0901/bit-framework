# bit-hotupdate

Cocos Creator çƒ­æ›´æ–°ç³»ç»Ÿå°è£…ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„çƒ­æ›´æ–°æ¥å£ã€‚

## ç®€ä»‹

`bit-hotupdate` æ˜¯åŸºäº Cocos Creator çš„çƒ­æ›´æ–°ç³»ç»Ÿå°è£…ï¼Œæä¾›å¢é‡æ›´æ–°å’Œç‰ˆæœ¬ç®¡ç†åŠŸèƒ½ã€‚æ”¯æŒ Android å’Œ iOS åŸç”Ÿå¹³å°ï¼Œç®€åŒ–äº†çƒ­æ›´æ–°çš„ä½¿ç”¨æµç¨‹ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- ğŸ”„ å¢é‡æ›´æ–°ï¼Œåªä¸‹è½½å˜åŒ–çš„æ–‡ä»¶
- ğŸ“¦ è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†å’Œå¯¹æ¯”
- âš¡ å®æ—¶ä¸‹è½½è¿›åº¦è·Ÿè¸ª
- ğŸ›¡ï¸ å®Œå–„çš„é”™è¯¯ç å’Œé‡è¯•æœºåˆ¶
- ğŸ¯ ç®€æ´çš„ API è®¾è®¡
- ğŸ“± æ”¯æŒ Android å’Œ iOS åŸç”Ÿå¹³å°

## å®‰è£…

```bash
npm install @gongxh/bit-hotupdate
```

## ä½¿ç”¨è¯´æ˜

### çƒ­æ›´æ–°ç®¡ç†å™¨ (HotUpdateManager)

å…¨å±€å•ä¾‹ï¼Œè´Ÿè´£çƒ­æ›´æ–°é…ç½®å’Œå®ä¾‹ç®¡ç†ã€‚

**åˆå§‹åŒ–é…ç½®**ï¼š
- `getInstance()` - è·å–å•ä¾‹å®ä¾‹
- `init(config)` - åˆå§‹åŒ–çƒ­æ›´æ–°ç³»ç»Ÿ
  - `config.manifestUrl` - æœ¬åœ° manifest æ–‡ä»¶è·¯å¾„
  - `config.writablePath` - çƒ­æ›´æ–°èµ„æºå­˜å‚¨è·¯å¾„

**å®ä¾‹ç®¡ç†**ï¼š
- `create()` - åˆ›å»ºçƒ­æ›´æ–°å®ä¾‹
- `resVersion` - è·å–å½“å‰èµ„æºç‰ˆæœ¬å·

### çƒ­æ›´æ–°å®ä¾‹ (HotUpdate)

æ‰§è¡Œå…·ä½“çš„æ›´æ–°æ“ä½œã€‚

**æ£€æŸ¥æ›´æ–°**ï¼š
- `checkUpdate()` - æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬
  - è¿”å› `Promise<ICheckUpdatePromiseResult>`
  - æˆåŠŸï¼šè¿”å›æ–°ç‰ˆæœ¬ä¿¡æ¯å’Œæ–‡ä»¶å¤§å°
  - å¤±è´¥ï¼šè¿”å›é”™è¯¯ç å’Œæ¶ˆæ¯

**å¼€å§‹æ›´æ–°**ï¼š
- `startUpdate(options)` - å¼€å§‹ä¸‹è½½æ›´æ–°
  - `options.skipCheck` - æ˜¯å¦è·³è¿‡æ£€æŸ¥ï¼ˆé»˜è®¤ falseï¼‰
  - `options.progress` - è¿›åº¦å›è°ƒ `(downloadedKB, totalKB) => void`
  - `options.complete` - å®Œæˆå›è°ƒ `(code, message) => void`

**é‡è¯•æ›´æ–°**ï¼š
- `retryUpdate()` - é‡è¯•å¤±è´¥çš„èµ„æºä¸‹è½½

**å±æ€§**ï¼š
- `resVersion` - å½“å‰èµ„æºç‰ˆæœ¬å·

### çŠ¶æ€ç  (HotUpdateCode)

å®šä¹‰äº†æ‰€æœ‰å¯èƒ½çš„æ›´æ–°çŠ¶æ€ï¼š

**æˆåŠŸçŠ¶æ€**ï¼š
- `Succeed` (0) - æ›´æ–°æˆåŠŸ

**ç‰¹æ®ŠçŠ¶æ€**ï¼š
- `PlatformNotSupported` (-1000) - å¹³å°ä¸æ”¯æŒï¼ˆéåŸç”Ÿå¹³å°ï¼‰
- `NotInitialized` (-1001) - æœªåˆå§‹åŒ–
- `LatestVersion` (-1002) - å·²æ˜¯æœ€æ–°ç‰ˆæœ¬
- `Updating` (-1003) - æ›´æ–°ä¸­

**é”™è¯¯çŠ¶æ€**ï¼š
- `LoadManifestFailed` (-1004) - åŠ è½½æœ¬åœ° manifest å¤±è´¥
- `ParseManifestFailed` (-1005) - è§£æ manifest æ–‡ä»¶å¤±è´¥
- `LoadVersionFailed` (-1006) - ä¸‹è½½ version.manifest å¤±è´¥
- `ParseVersionFailed` (-1007) - è§£æ version.manifest å¤±è´¥
- `UpdateFailed` (-1008) - æ›´æ–°å¤±è´¥ï¼ˆå¯é‡è¯•ï¼‰
- `UpdateError` (-1009) - æ›´æ–°é”™è¯¯
- `DecompressError` (-1010) - è§£å‹é”™è¯¯

### Manifest æ–‡ä»¶

çƒ­æ›´æ–°éœ€è¦ä¸¤ä¸ª manifest æ–‡ä»¶ï¼š

1. **project.manifest** - å®Œæ•´çš„èµ„æºæ¸…å•
   - åŒ…å«æ‰€æœ‰èµ„æºçš„ MD5 å’Œå¤§å°
   - ç”¨äºè®¡ç®—éœ€è¦ä¸‹è½½çš„æ–‡ä»¶

2. **version.manifest** - è½»é‡çº§ç‰ˆæœ¬æ–‡ä»¶
   - åªåŒ…å«ç‰ˆæœ¬ä¿¡æ¯
   - ç”¨äºå¿«é€Ÿæ£€æŸ¥ç‰ˆæœ¬

### å…¸å‹ä½¿ç”¨æµç¨‹

1. **åˆå§‹åŒ–** - æ¸¸æˆå¯åŠ¨æ—¶åˆå§‹åŒ– HotUpdateManager
2. **åˆ›å»ºå®ä¾‹** - åˆ›å»º HotUpdate å®ä¾‹
3. **æ£€æŸ¥æ›´æ–°** - è°ƒç”¨ checkUpdate() æ£€æŸ¥æ–°ç‰ˆæœ¬
4. **æç¤ºç”¨æˆ·** - æ˜¾ç¤ºæ›´æ–°å¯¹è¯æ¡†
5. **å¼€å§‹æ›´æ–°** - ç”¨æˆ·ç¡®è®¤åè°ƒç”¨ startUpdate()
6. **æ˜¾ç¤ºè¿›åº¦** - æ›´æ–°è¿›åº¦æ¡
7. **å¤„ç†ç»“æœ** - æ›´æ–°æˆåŠŸåé‡å¯æ¸¸æˆ

### æœåŠ¡ç«¯é…ç½®

**ç›®å½•ç»“æ„**ï¼š
```
hotupdate/
â”œâ”€â”€ version.manifest
â”œâ”€â”€ project.manifest
â”œâ”€â”€ assets/
â””â”€â”€ src/
```

**Nginx é…ç½®è¦ç‚¹**ï¼š
- å…è®¸è·¨åŸŸè¯·æ±‚
- manifest æ–‡ä»¶ç¦æ­¢ç¼“å­˜
- æ”¯æŒ Range è¯·æ±‚ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰

è¯¦ç»† API è¯·æŸ¥çœ‹ `bit-hotupdate.d.ts` ç±»å‹å®šä¹‰æ–‡ä»¶ã€‚

## ä¾èµ–

- [@gongxh/bit-core](https://www.npmjs.com/package/@gongxh/bit-core) - æ ¸å¿ƒåŠŸèƒ½

## è®¸å¯è¯

MIT License

## ä½œè€…

**bitè€å®«** (gongxh)  
**é‚®ç®±**: gong.xinhai@163.com

## æºç ä»“åº“

- [GitHub](https://github.com/Gongxh0901/bit-framework)
- [npm](https://www.npmjs.com/package/@gongxh/bit-hotupdate)
